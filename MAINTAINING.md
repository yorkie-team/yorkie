# Maintaining Yorkie

## Releasing a New Version

### 1. Update the version number.

- Update `YORKIE_VERSION` in [Makefile](https://github.com/yorkie-team/yorkie/blob/main/Makefile#L1).
- Update `version` and `appVersion` in [yorkie-cluster Helm Chart](https://github.com/yorkie-team/yorkie/blob/main/build/charts/yorkie-cluster/Chart.yaml#L14-L15).
- If `yorkie-monitoring` or `yorkie-argocd` Helm Chart have changes, you also need to update `version` and `appVersion` for each chart.
  - [yorkie-monitoring Helm Chart](https://github.com/yorkie-team/yorkie/blob/main/build/charts/yorkie-monitoring/Chart.yaml#L14-L15)
  - [yorkie-argocd Helm Chart](https://github.com/yorkie-team/yorkie/blob/main/build/charts/yorkie-argocd/Chart.yaml#L14-L15)
- Update `version`s in API documentation.
  - [yorkie.base.yaml](https://github.com/yorkie-team/yorkie/blob/main/api/docs/yorkie.base.yaml#L5)
  - [admin.openapi.yaml](https://github.com/yorkie-team/yorkie/blob/main/api/docs/yorkie/v1/admin.openapi.yaml#L6)
  - [yorkie.openapi.yaml](https://github.com/yorkie-team/yorkie/blob/main/api/docs/yorkie/v1/yorkie.openapi.yaml#L6)
  - [resources.openapi.yaml](https://github.com/yorkie-team/yorkie/blob/main/api/docs/yorkie/v1/resources.openapi.yaml#L6)
- Also, you need to update `helmChartTargetRevision` in `yorkie-argocd` Helm Chart's [values.yaml](https://github.com/yorkie-team/yorkie/blob/main/build/charts/yorkie-argocd/values.yaml#L13)

### 2. Write changelog of this version in [CHANGELOG.md](https://github.com/yorkie-team/yorkie/blob/main/CHANGELOG.md).

Copy the release notes automatically generated by GitHub and categorize them as `Added`/`Changed`/`Fixed`.

1. Click on the `Releases` in GitHub.
2. Click on the `Draft a new release` button.
3. Create a new tag.
4. Click on the `Generate release notes` button.
5. Copy the content generated into the body and categorize each item.

<img width="600" alt="image" src="https://user-images.githubusercontent.com/81357083/233356577-acc1dd33-5ad5-4b51-9f2e-6c771a063ccd.png">

### 3. Create [Pull Request](https://github.com/yorkie-team/yorkie/commits/main/CHANGELOG.md) for changelog and merge it into main.

### 4. Build binaries to attach a new release.

Executing the following command will generate five zip files for each operating system in the `binaries` folder.

```bash
$ make build-binaries
```

### 5. Publish [a new release](https://github.com/yorkie-team/yorkie/releases/new).

After creating the release in step 2, follow these steps:

1. Attach the binary files built in step 4.
2. Click on the `Publish release` button.

<img width="600" alt="image" src="https://user-images.githubusercontent.com/81357083/233360815-86b723ec-3e63-4640-af1f-e61f61519549.png">

### 6. Deploy

#### 1) Docker

When you publish the release in step 5, [GitHub action](https://github.com/yorkie-team/yorkie/blob/main/.github/workflows/docker-publish.yml) will deploy Yorkie to [Docker Hub](https://hub.docker.com/repository/docker/yorkieteam/yorkie).

#### 2) Homebrew

Running the command below will automatically create a pull request for deploying to Homebrew.  
Once the PR is merged to [homebrew-core](https://github.com/Homebrew/homebrew-core), Yorkie will also be deployed to Homebrew.

```bash
$ brew bump-formula-pr yorkie --tag v{YORKIE_VERSION}
```
